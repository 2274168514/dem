<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Permissions-Policy" content="unload=(), browsing-topics=(), idle-detection=(), magnetometer=(), accelerometer=(), gyroscope=(), camera=(), microphone=(), geolocation=(), payment=(), interest-cohort=()">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁºñÁ®ãÊïôÂ≠¶Âπ≥Âè∞</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            height: 100vh;
            display: flex;
            overflow: hidden;
            background-color: #f0f2f5;
        }

        /* Left Side - Illustration */
        .illustration {
            width: 60%;
            background-color: #e6e6e6;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center; /* Centered vertically */
            overflow: hidden;
        }

        .character-group {
            position: relative;
            width: 600px;
            height: 450px;
            transform: scale(1.4); /* Overall scale up */
        }

        .char {
            position: absolute;
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform-origin: bottom center;
            will-change: transform;
        }

        /* Entrance Animation */
        @keyframes elasticEntrance {
            0% { opacity: 0; transform: translateY(400px) scale(0.3) rotate(-15deg); }
            50% { opacity: 1; transform: translateY(-40px) scale(1.1) rotate(5deg); }
            65% { transform: translateY(15px) scale(0.95) rotate(-3deg); }
            80% { transform: translateY(-10px) scale(1.02) rotate(2deg); }
            100% { transform: translateY(0) scale(1) rotate(0); }
        }

        .char.entrance-hidden {
            opacity: 0;
            transform: translateY(400px) scale(0.5);
        }

        .char.entering {
            animation: elasticEntrance 1.5s cubic-bezier(0.28, 0.84, 0.42, 1) forwards;
        }

        /* Purple Character - Tall, Back Left */
        .char-purple {
            width: 170px;
            height: 360px;
            background-color: #6c5ce7;
            bottom: 0;
            left: 80px;
            border-radius: 8px 8px 0 0; /* Sharper corners */
            z-index: 1;
            transform: skewY(-2deg); /* Slight angle */
        }

        /* Black Character - Medium, Back Right */
        .char-black {
            width: 130px;
            height: 240px;
            background-color: #2d3436;
            bottom: 0;
            left: 240px;
            border-radius: 20px 20px 0 0;
            z-index: 2;
        }

        /* Orange Character - Blob, Front Left */
        .char-orange {
            width: 240px;
            height: 170px;
            background-color: #ff7675;
            bottom: 0;
            left: 0px;
            border-radius: 120px 120px 0 0;
            z-index: 3;
        }

        /* Yellow Character - Blob, Front Right */
        .char-yellow {
            width: 150px;
            height: 210px;
            background-color: #ffeaa7;
            bottom: 0;
            left: 350px;
            border-radius: 75px 75px 0 0;
            z-index: 3;
        }

        /* Eyes Container */
        .eyes {
            position: absolute;
            display: flex;
            justify-content: center;
            width: 100%;
            pointer-events: none;
        }

        /* Eye Styles */
        .eye {
            position: relative;
            background: white;
            border-radius: 50%;
            overflow: hidden;
            transition: height 0.1s;
        }
        
        .eye-dot {
            background: #2d3436;
            border-radius: 50%;
        }

        .pupil {
            position: absolute;
            background: #2d3436;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: transform 0.1s ease-out;
        }

        /* Character Specific Features */
        
        /* Purple */
        .char-purple .eyes { top: 60px; gap: 30px; }
        .char-purple .eye { width: 28px; height: 28px; }
        .char-purple .pupil { width: 12px; height: 12px; }
        .char-purple .mouth {
            position: absolute;
            width: 6px;
            height: 20px;
            background: #2d3436;
            border-radius: 3px;
            left: 50%;
            top: 110px;
            transform: translateX(-50%);
        }

        /* Black */
        .char-black .eyes { top: 50px; gap: 18px; }
        .char-black .eye { width: 26px; height: 26px; }
        .char-black .pupil { width: 10px; height: 10px; }

        /* Orange - Bean Eyes */
        .char-orange .eyes { top: 50px; gap: 50px; }
        .char-orange .eye { 
            width: 16px; 
            height: 16px; 
            background: #2d3436; 
            overflow: visible;
        }
        .char-orange .pupil { display: none; }
        .char-orange .mouth {
            position: absolute;
            width: 16px;
            height: 16px;
            background: #2d3436;
            border-radius: 50%;
            left: 50%;
            top: 80px;
            transform: translateX(-50%);
            transition: all 0.3s ease;
        }

        .char-orange .mouth.smile {
            width: 24px;
            height: 12px;
            border-radius: 0 0 24px 24px;
            top: 82px; /* Adjust top slightly to align */
        }

        /* Yellow - Side Eye (Chick) */
        .char-yellow .eyes { top: 45px; justify-content: flex-end; padding-right: 35px; }
        .char-yellow .eye { 
            width: 18px; 
            height: 18px; 
            background: #2d3436; 
            overflow: visible;
        }
        .char-yellow .pupil { display: none; }
        .char-yellow .mouth {
            position: absolute;
            width: 45px; /* Longer mouth */
            height: 6px;
            background: #2d3436;
            border-radius: 3px;
            right: -12px; /* Stick out from the edge */
            top: 85px;
            transform: rotate(-8deg);
        }

        /* Blinking Animation Class */
        .blink .eye {
            height: 2px !important;
            margin-top: 11px; /* Center the closed eye line */
        }
        /* Adjust margin for different eye sizes when blinking */
        .char-purple.blink .eye { margin-top: 11px; }
        .char-black.blink .eye { margin-top: 9px; }
        .char-orange.blink .eye { height: 2px !important; margin-top: 5px; background: #2d3436; }
        .char-yellow.blink .eye { height: 2px !important; margin-top: 6px; background: #2d3436; }


        /* States */
        
        /* Expecting (Now on Username) */
        .char.expecting {
            transform: translateY(-15px) scale(1.05);
        }
        .char-purple.expecting { transform: translateY(-20px) scale(1.05) rotate(-5deg); }
        .char-orange.expecting { transform: translateY(-10px) scale(1.05) rotate(2deg); }
        .char-yellow.expecting { transform: translateY(-15px) scale(1.05) rotate(-3deg); }

        /* Leaning Right (Now on Password) */
        .char.leaning-right {
            transform: translateX(25px) rotate(5deg);
        }
        .char-purple.leaning-right { transform: translateX(30px) rotate(5deg) skewX(-2deg); }
        .char-black.leaning-right { transform: translateX(20px) rotate(5deg); }
        .char-orange.leaning-right { transform: translateX(25px) rotate(5deg); }
        .char-yellow.leaning-right { transform: translateX(20px) rotate(5deg); }

        /* Shy (Show Password) */
        .char.shy {
            /* Rotate to show back */
            transform: rotateY(180deg);
        }
        /* Ensure backface is visible and same color */
        .char {
            backface-visibility: visible; 
        }
        /* Hide facial features when rotated */
        .char.shy .eyes, 
        .char.shy .mouth {
            opacity: 0;
            transition: opacity 0.2s;
        }

        /* Typing Animation */
        .char.typing {
            animation: bob 0.4s infinite alternate ease-in-out;
        }
        @keyframes bob {
            0% { transform: translateY(0); }
            100% { transform: translateY(-5px); }
        }

        /* Right Side - Form */
        .login-form {
            width: 40%;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            position: relative;
            z-index: 10;
        }

        .form-container {
            width: 100%;
            max-width: 400px;
        }

        .logo {
            margin-bottom: 30px;
            text-align: center;
        }
        .logo i {
            font-size: 40px;
            color: #2d3436;
        }

        h1 {
            font-size: 32px;
            margin-bottom: 10px;
            color: #2d3436;
            text-align: center;
            font-weight: 700;
        }

        p.subtitle {
            color: #b2bec3;
            margin-bottom: 40px;
            text-align: center;
        }

        .input-group {
            margin-bottom: 20px;
            position: relative;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #636e72;
            font-weight: 600;
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #dfe6e9;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
            background: #f9f9f9;
        }

        .input-group input:focus {
            outline: none;
            border-color: #6c5ce7;
            background: white;
            box-shadow: 0 4px 10px rgba(108, 92, 231, 0.1);
        }

        .password-toggle {
            position: absolute;
            right: 15px;
            top: 45px;
            cursor: pointer;
            color: #b2bec3;
            transition: color 0.3s;
            padding: 5px;
        }
        
        .password-toggle:hover {
            color: #6c5ce7;
        }

        .actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            font-size: 14px;
            color: #636e72;
        }

        .btn {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 15px;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background-color: #2d3436;
            color: white;
            box-shadow: 0 4px 6px rgba(45, 52, 54, 0.2);
        }
        
        .btn-primary:hover {
            background-color: #000;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(45, 52, 54, 0.3);
        }

        .btn-google {
            background-color: white;
            color: #2d3436;
            border: 2px solid #f1f2f6;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-google:hover {
            background-color: #f8f9fa;
            border-color: #dfe6e9;
        }

        /* Character Error Animation */
        @keyframes charShake {
            0%, 100% { margin-left: 0; }
            20% { margin-left: -10px; }
            40% { margin-left: 10px; }
            60% { margin-left: -10px; }
            80% { margin-left: 10px; }
        }
        
        .char.error-shake {
            animation: charShake 0.4s ease-in-out;
        }

        .signup-link {
            text-align: center;
            font-size: 14px;
            color: #636e72;
        }
        
        .signup-link a {
            color: #2d3436;
            text-decoration: none;
            font-weight: 600;
        }

        /* Error Message */
        #error-msg {
            background-color: #ffecec;
            color: #ff7675;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
            display: none;
            font-size: 14px;
            border: 1px solid #ffcccc;
        }

        /* Register Modal Styles */
        .register-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .register-modal.show {
            opacity: 1;
            pointer-events: all;
        }

        .register-content {
            background: white;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 480px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            transform: translateY(30px) scale(0.95);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
        }

        .register-modal.show .register-content {
            transform: translateY(0) scale(1);
        }

        .register-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.05);
            border: none;
            color: #2d3436;
            font-size: 24px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .register-close:hover {
            background: rgba(0, 0, 0, 0.1);
            transform: rotate(90deg);
        }

        .register-body {
            padding: 40px 30px 30px 30px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .role-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            background: #f1f2f6;
            padding: 4px;
            border-radius: 10px;
        }

        .role-option {
            flex: 1;
            padding: 12px;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: #636e72;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 14px;
        }

        .role-option.active {
            background: white;
            color: #2d3436;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .role-fields {
            background: #f9f9f9;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #eee;
        }

        .role-fields-title {
            color: #2d3436;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .register-actions {
            display: flex;
            gap: 12px;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .btn-cancel {
            flex: 1;
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            background: #dfe6e9;
            color: #636e72;
            transition: all 0.2s;
        }

        .btn-cancel:hover {
            background: #b2bec3;
            color: white;
        }

        .btn-submit {
            flex: 2;
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            background: #2d3436;
            color: white;
            transition: all 0.2s;
        }

        .btn-submit:hover {
            background: #000;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>

    <div class="illustration">
        <div class="character-group">
            <!-- Purple -->
            <div class="char char-purple entrance-hidden" id="char-purple">
                <div class="eyes">
                    <div class="eye"><div class="pupil"></div></div>
                    <div class="eye"><div class="pupil"></div></div>
                </div>
                <div class="mouth"></div>
            </div>
            
            <!-- Black -->
            <div class="char char-black entrance-hidden" id="char-black">
                <div class="eyes">
                    <div class="eye"><div class="pupil"></div></div>
                    <div class="eye"><div class="pupil"></div></div>
                </div>
            </div>

            <!-- Orange -->
            <div class="char char-orange entrance-hidden" id="char-orange">
                <div class="eyes">
                    <div class="eye"></div>
                    <div class="eye"></div>
                </div>
                <div class="mouth"></div>
            </div>

            <!-- Yellow -->
            <div class="char char-yellow entrance-hidden" id="char-yellow">
                <div class="eyes">
                    <div class="eye"></div>
                </div>
                <div class="mouth"></div>
            </div>
        </div>
    </div>

    <div class="login-form">
        <div class="lang-switch" style="position: absolute; top: 20px; right: 20px; cursor: pointer; font-weight: 600; color: #636e72; padding: 5px 10px; border: 1px solid #dfe6e9; border-radius: 5px;">
            <span id="lang-btn">EN</span>
        </div>
        <div class="form-container">
            <div class="logo" style="display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 20px;">
                <img src="image/logo.png" alt="Logo" style="height: 50px; width: auto;">
                <span style="font-size: 40px; font-weight: 800; color: #2d3436; letter-spacing: -1px;">SLYCoder</span>
            </div>
            <h1 id="welcome-text" style="margin-bottom: 40px;">Ê¨¢ËøéÂõûÊù•ÔºÅ</h1>

            <div id="error-msg"></div>

            <form id="loginForm">
                <div class="input-group">
                    <label id="label-username">Áî®Êà∑Âêç / ÈÇÆÁÆ±</label>
                    <input type="text" id="username" placeholder="ËØ∑ËæìÂÖ•Áî®Êà∑Âêç" required>
                </div>

                <div class="input-group">
                    <label id="label-password">ÂØÜÁ†Å</label>
                    <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    <i class="fas fa-eye password-toggle" id="togglePassword"></i>
                </div>

                <div class="actions">
                    <label><input type="checkbox"> <span id="label-remember">30Â§©ÂÜÖÂÖçÁôªÂΩï</span></label>
                    <a href="#" id="link-forgot" style="color: #2d3436; text-decoration: none;">ÂøòËÆ∞ÂØÜÁ†ÅÔºü</a>
                </div>

                <button type="submit" class="btn btn-primary" id="btn-login">ÁôªÂΩï</button>
            </form>

            <div class="signup-link">
                <span id="text-signup">ËøòÊ≤°ÊúâË¥¶Âè∑Ôºü</span> <a href="#" id="link-signup">Ê≥®ÂÜå</a>
            </div>
        </div>
    </div>

    <script>
        // --- Animation & Interaction Logic (Independent of Auth) ---
        document.addEventListener('DOMContentLoaded', () => {
            const chars = document.querySelectorAll('.char');
            const charGroup = document.querySelector('.character-group');
            const passwordInput = document.getElementById('password');
            const usernameInput = document.getElementById('username');
            const togglePassword = document.getElementById('togglePassword');

            console.log('Animation script loaded. Characters found:', chars.length);

            // 0. Entrance Animation
            setTimeout(() => {
                chars.forEach((char, index) => {
                    setTimeout(() => {
                        char.classList.remove('entrance-hidden');
                        char.classList.add('entering');
                        
                        // Remove animation class after it finishes to allow interactions
                        setTimeout(() => {
                            char.classList.remove('entering');
                        }, 1500); // Match animation duration
                    }, index * 300); // Slower stagger for more dramatic effect
                });
            }, 300);

            // Helper to move eyes
            function moveEyes(targetX, targetY) {
                chars.forEach(char => {
                    const pupils = char.querySelectorAll('.pupil');
                    const eyes = char.querySelectorAll('.eye');

                    // Strategy 1: Characters with Pupils (Purple & Black)
                    if (pupils.length > 0) {
                        pupils.forEach(pupil => {
                            const eye = pupil.parentElement;
                            const eyeRect = eye.getBoundingClientRect();
                            const eyeCenterX = eyeRect.left + eyeRect.width / 2;
                            const eyeCenterY = eyeRect.top + eyeRect.height / 2;

                            const angle = Math.atan2(targetY - eyeCenterY, targetX - eyeCenterX);
                            const maxRadius = eyeRect.width / 3; // Increased range
                            const dist = Math.min(maxRadius, Math.hypot(targetX - eyeCenterX, targetY - eyeCenterY) / 5); // Increased sensitivity

                            const x = Math.cos(angle) * dist;
                            const y = Math.sin(angle) * dist;

                            pupil.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
                        });
                    } 
                    // Strategy 2: Characters with Solid Eyes (Orange & Yellow)
                    else {
                        eyes.forEach(eye => {
                            const charRect = char.getBoundingClientRect();
                            const charCenterX = charRect.left + charRect.width / 2;
                            const charCenterY = charRect.top + charRect.height / 2;

                            const angle = Math.atan2(targetY - charCenterY, targetX - charCenterX);
                            const maxMove = 15; // Increased range
                            const dist = Math.min(maxMove, Math.hypot(targetX - charCenterX, targetY - charCenterY) / 10); // Increased sensitivity

                            const x = Math.cos(angle) * dist;
                            const y = Math.sin(angle) * dist;

                            eye.style.transform = `translate(${x}px, ${y}px)`;
                        });
                    }

                    // Strategy 3: Yellow Character Mouth (Head) Movement
                    if (char.classList.contains('char-yellow')) {
                        const mouth = char.querySelector('.mouth');
                        if (mouth) {
                            const charRect = char.getBoundingClientRect();
                            // Use width for both dimensions to find the center of the "head" circle
                            // The head is a semi-circle at the top, so center is at (width/2, width/2)
                            const centerX = charRect.left + charRect.width / 2;
                            const centerY = charRect.top + charRect.width / 2;

                            const angle = Math.atan2(targetY - centerY, targetX - centerX);
                            
                            // Radius should be half of the original width (150px / 2 = 75px)
                            // We add a bit to make it stick out slightly
                            const radius = 78; 

                            const x = Math.cos(angle) * radius;
                            const y = Math.sin(angle) * radius;

                            // Reset positioning to center to allow full rotation around it
                            mouth.style.right = 'auto';
                            mouth.style.left = '75px'; // Original center X
                            mouth.style.top = '75px';  // Original center Y
                            mouth.style.width = '45px';
                            mouth.style.transformOrigin = 'center center';

                            const deg = angle * (180 / Math.PI);

                            // Translate to edge and rotate
                            mouth.style.transform = `translate(-50%, -50%) translate(${x}px, ${y}px) rotate(${deg}deg)`;
                        }
                    }
                });
            }

            // 1. Eye Tracking & Parallax
            document.addEventListener('mousemove', (e) => {
                // Don't track if characters are shy
                if (document.querySelector('.char.shy')) return;

                // If typing (focused on username), don't follow mouse, follow input logic instead
                if (document.activeElement === usernameInput) return;

                moveEyes(e.clientX, e.clientY);

                // Parallax Effect
                const centerX = window.innerWidth / 2;
                const centerY = window.innerHeight / 2;
                const moveX = (e.clientX - centerX) / 20; // Increased movement
                const moveY = (e.clientY - centerY) / 20; // Increased movement
                
                charGroup.style.transform = `scale(1.1) translate(${moveX}px, ${moveY}px)`;
            });

            // 2. Blinking Animation
            function triggerBlink() {
                if (document.querySelector('.char.shy')) return;

                const randomChar = chars[Math.floor(Math.random() * chars.length)];
                if(randomChar) {
                    randomChar.classList.add('blink');
                    setTimeout(() => {
                        randomChar.classList.remove('blink');
                    }, 200);
                }
                setTimeout(triggerBlink, Math.random() * 3000 + 1000);
            }
            setTimeout(triggerBlink, 2000);

            // Random Smile for Orange Character
            function triggerSmile() {
                const orangeChar = document.querySelector('.char-orange');
                if (orangeChar && !orangeChar.classList.contains('shy')) {
                    const mouth = orangeChar.querySelector('.mouth');
                    if (mouth) {
                        mouth.classList.add('smile');
                        setTimeout(() => {
                            mouth.classList.remove('smile');
                        }, 5000); // Smile for 5 seconds
                    }
                }
                // Random interval between 6 and 11 seconds
                setTimeout(triggerSmile, Math.random() * 5000 + 6000);
            }
            setTimeout(triggerSmile, 3000);

            // 3. Username Interaction (Typing & Reading & Expecting)
            if(usernameInput) {
                usernameInput.addEventListener('focus', () => {
                    chars.forEach(char => {
                        char.classList.remove('shy');
                        char.classList.remove('leaning-right');
                        char.classList.add('expecting'); // Moved from Password
                    });
                });

                usernameInput.addEventListener('blur', () => {
                    chars.forEach(char => {
                        char.classList.remove('expecting');
                    });
                });

                usernameInput.addEventListener('input', (e) => {
                    const val = e.target.value;
                    const inputRect = usernameInput.getBoundingClientRect();
                    // Estimate cursor position based on length (rough approx)
                    const cursorX = inputRect.left + 10 + (val.length * 8); 
                    const cursorY = inputRect.top + inputRect.height / 2;

                    moveEyes(cursorX, cursorY);

                    // Bobbing animation
                    chars.forEach(char => {
                        char.classList.add('typing');
                        // Remove class to restart animation if needed, or just let CSS loop
                    });
                    
                    // Clear typing class after a short delay
                    clearTimeout(window.typingTimer);
                    window.typingTimer = setTimeout(() => {
                        chars.forEach(char => char.classList.remove('typing'));
                    }, 400);
                });
            }

            // 4. Password Interaction (Leaning Right)
            if(passwordInput) {
                passwordInput.addEventListener('focus', () => {
                    chars.forEach(char => {
                        char.classList.add('leaning-right'); // New animation
                        char.classList.remove('shy');
                        char.classList.remove('expecting');
                    });
                });

                passwordInput.addEventListener('blur', () => {
                    chars.forEach(char => {
                        char.classList.remove('leaning-right');
                        if (passwordInput.type === 'text') {
                            char.classList.add('shy');
                        } else {
                            char.classList.remove('shy');
                        }
                    });
                });
            }

            // 5. Toggle Password (Shy)
            if(togglePassword) {
                togglePassword.addEventListener('click', () => {
                    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    passwordInput.setAttribute('type', type);
                    
                    togglePassword.classList.toggle('fa-eye');
                    togglePassword.classList.toggle('fa-eye-slash');

                    if (type === 'text') {
                        // Show Password -> Shy
                        chars.forEach(char => {
                            char.classList.add('shy');
                            char.classList.remove('expecting');
                        });
                    } else {
                        // Hide Password -> Back to normal
                        chars.forEach(char => {
                            char.classList.remove('shy');
                            if (document.activeElement === passwordInput) {
                                char.classList.add('expecting');
                            }
                        });
                    }
                });
            }
        });
    </script>

    <script>
        /**
         * Áî®Êà∑ËÆ§ËØÅÁ≥ªÁªü (Inlined for file:// access)
         */
        const API_PORT = 5024;
        // Âä®ÊÄÅÊ£ÄÊµãAPIÂü∫Á°ÄURL
        const API_BASE = (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1')
            ? `http://127.0.0.1:${API_PORT}/api`
            : '/api';

        const USER_ROLES = {
            ADMIN: 'admin',
            TEACHER: 'teacher',
            STUDENT: 'student'
        };

        const PERMISSIONS = {
            USER_CREATE: 'user:create',
            USER_READ: 'user:read',
            USER_UPDATE: 'user:update',
            USER_DELETE: 'user:delete',
            COURSE_CREATE: 'course:create',
            COURSE_READ: 'course:read',
            COURSE_UPDATE: 'course:update',
            COURSE_DELETE: 'course:delete',
            ASSIGNMENT_CREATE: 'assignment:create',
            ASSIGNMENT_READ: 'assignment:read',
            ASSIGNMENT_UPDATE: 'assignment:update',
            ASSIGNMENT_DELETE: 'assignment:delete',
            ASSIGNMENT_SUBMIT: 'assignment:submit',
            ASSIGNMENT_GRADE: 'assignment:grade'
        };

        const ROLE_PERMISSIONS = {
            [USER_ROLES.ADMIN]: [
                PERMISSIONS.USER_CREATE, PERMISSIONS.USER_READ, PERMISSIONS.USER_UPDATE, PERMISSIONS.USER_DELETE,
                PERMISSIONS.COURSE_CREATE, PERMISSIONS.COURSE_READ, PERMISSIONS.COURSE_UPDATE, PERMISSIONS.COURSE_DELETE,
                PERMISSIONS.ASSIGNMENT_CREATE, PERMISSIONS.ASSIGNMENT_READ, PERMISSIONS.ASSIGNMENT_UPDATE,
                PERMISSIONS.ASSIGNMENT_DELETE, PERMISSIONS.ASSIGNMENT_SUBMIT, PERMISSIONS.ASSIGNMENT_GRADE
            ],
            [USER_ROLES.TEACHER]: [
                PERMISSIONS.USER_READ, PERMISSIONS.USER_UPDATE,
                PERMISSIONS.COURSE_READ, PERMISSIONS.COURSE_UPDATE,
                PERMISSIONS.ASSIGNMENT_CREATE, PERMISSIONS.ASSIGNMENT_READ,
                PERMISSIONS.ASSIGNMENT_UPDATE, PERMISSIONS.ASSIGNMENT_DELETE, PERMISSIONS.ASSIGNMENT_GRADE
            ],
            [USER_ROLES.STUDENT]: [
                PERMISSIONS.USER_UPDATE,
                PERMISSIONS.COURSE_READ,
                PERMISSIONS.ASSIGNMENT_READ, PERMISSIONS.ASSIGNMENT_SUBMIT
            ]
        };

        class UserAuth {
            constructor() {
                this.currentUser = null;
                this.initializeAuth();
            }

            initializeAuth() {
                const savedUser = sessionStorage.getItem('current-user');
                if (savedUser) {
                    try {
                        this.currentUser = JSON.parse(savedUser);
                    } catch (error) {
                        console.error('Ëß£ÊûêÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•:', error);
                        sessionStorage.removeItem('current-user');
                    }
                }
            }

            async register(userData) {
                // Note: In this simplified version, we might skip admin check for public registration
                // or keep it if the backend enforces it. The original code checked for admin role locally.
                // For public registration (Sign Up button), we usually don't need to be admin.
                // However, the original code had: if (!this.hasRole(USER_ROLES.ADMIN)) ...
                // But the new registration modal calls /api/public/register directly in handleRegister function.
                // So this method might not be used by the new modal.
                // We'll keep it as is for compatibility.
                
                const { username, password, email, role, fullName, studentId = null, employeeId = null } = userData;

                try {
                    if (!this.hasRole(USER_ROLES.ADMIN)) {
                        // For public registration, we should use a different method or endpoint.
                        // But here we just return error as per original logic.
                        return {
                            success: false,
                            message: 'Âè™ÊúâÁÆ°ÁêÜÂëòÂèØ‰ª•ÂàõÂª∫Áî®Êà∑'
                        };
                    }

                    const requestData = {
                        username: username.trim(),
                        email: email.trim(),
                        password: password,
                        fullName: fullName.trim(),
                        role: role,
                        studentId: studentId?.trim() || null,
                        employeeId: employeeId?.trim() || null
                    };

                    const response = await fetch(`${API_BASE}/users/register`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(requestData)
                    });

                    const result = await response.json();
                    if (result.success && result.user) {
                        this.createUserRegistrationNotification(result.user);
                    }
                    return result;

                } catch (error) {
                    console.error('Ê≥®ÂÜåËøáÁ®ã‰∏≠ÂèëÁîüÈîôËØØ:', error);
                    return { success: false, message: error.message || 'Ê≥®ÂÜåËøáÁ®ã‰∏≠ÂèëÁîüÈîôËØØ' };
                }
            }

            async login(username, password) {
                console.log('üîê ÂºÄÂßãÁôªÂΩïËØ∑Ê±Ç...');
                const startTime = Date.now();
                
                try {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 30000);

                    const response = await fetch(`${API_BASE}/users/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username: username.trim(), password: password }),
                        signal: controller.signal
                    });

                    clearTimeout(timeoutId);
                    const result = await response.json();

                    if (result.success) {
                        this.currentUser = result.user;
                        const userStr = JSON.stringify(this.currentUser);
                        sessionStorage.setItem('current-user', userStr);
                        localStorage.setItem('currentUser', userStr);
                        localStorage.setItem('oj-current-user', userStr);
                        return { success: true, message: result.message, user: this.currentUser };
                    } else {
                        return { success: false, message: result.message };
                    }
                } catch (error) {
                    console.error('ÁôªÂΩïÈîôËØØ:', error);
                    if (error.name === 'AbortError') return { success: false, message: 'ÁôªÂΩïË∂ÖÊó∂' };
                    return { success: false, message: 'ÁôªÂΩïÂ§±Ë¥•: ' + error.message };
                }
            }

            logout() {
                this.currentUser = null;
                sessionStorage.removeItem('current-user');
                localStorage.removeItem('currentUser');
                localStorage.removeItem('oj-current-user');
            }

            isLoggedIn() { return !!this.currentUser; }
            getCurrentUser() { return this.currentUser; }
            
            hasPermission(permission) {
                if (!this.currentUser) return false;
                const userPermissions = ROLE_PERMISSIONS[this.currentUser.role] || [];
                return userPermissions.includes(permission);
            }

            hasRole(role) { return this.currentUser && this.currentUser.role === role; }

            async createUserRegistrationNotification(newUser) {
                try {
                    const notificationManager = window.notificationManager;
                    if (!notificationManager) return;

                    const adminResponse = await fetch(`${API_BASE}/users/query`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            sql: 'SELECT id, username, email, full_name, role FROM users WHERE role = ?',
                            params: ['admin']
                        })
                    });

                    if (adminResponse.ok) {
                        const adminResult = await adminResponse.json();
                        const admins = adminResult.data || [];
                        for (const admin of admins) {
                            await notificationManager.createNotification('user_registration', admin.id, {
                                username: newUser.username,
                                full_name: newUser.fullName,
                                role: newUser.role,
                                senderId: this.currentUser?.id,
                                relatedType: 'user',
                                relatedId: newUser.id
                            });
                        }
                    }
                } catch (error) {
                    console.error('ÂàõÂª∫ÈÄöÁü•Â§±Ë¥•:', error);
                }
            }
        }

        // --- Main Logic ---
        const auth = new UserAuth();
        const loginForm = document.getElementById('loginForm');
        const errorMsg = document.getElementById('error-msg');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const chars = document.querySelectorAll('.char');

        // Login Logic
        if(loginForm) {
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const username = usernameInput.value;
                const password = passwordInput.value;
                const btn = loginForm.querySelector('.btn-primary');
                
                btn.textContent = 'ÁôªÂΩï‰∏≠...';
                btn.disabled = true;
                errorMsg.style.display = 'none';

                try {
                    const result = await auth.login(username, password);
                    if (result.success) {
                        // Success animation
                        chars.forEach((char, index) => {
                            setTimeout(() => {
                                char.style.transform = 'translateY(20px)'; // Anticipation
                                setTimeout(() => {
                                    char.style.transition = 'transform 0.5s cubic-bezier(0.6, -0.28, 0.735, 0.045)';
                                    char.style.transform = 'translateY(100vh)'; // Fall down or fly up? Let's fly up happily
                                    char.style.transform = 'translateY(-120vh)';
                                }, 200);
                            }, index * 100);
                        });
                        
                        setTimeout(() => {
                            window.location.href = 'main.html';
                        }, 100);
                    } else {
                        errorMsg.textContent = result.message || 'ÁôªÂΩïÂ§±Ë¥•';
                        errorMsg.style.display = 'block';
                        btn.textContent = 'ÁôªÂΩï';
                        btn.disabled = false;
                        
                        // Shake animation
                        loginForm.style.animation = 'shake 0.5s';
                        setTimeout(() => loginForm.style.animation = '', 500);

                        // Character Shake Animation
                        chars.forEach(char => {
                            char.classList.add('error-shake');
                            setTimeout(() => char.classList.remove('error-shake'), 400);
                        });
                    }
                } catch (err) {
                    console.error(err);
                    errorMsg.textContent = 'ÂèëÁîüÈîôËØØ';
                    errorMsg.style.display = 'block';
                    btn.textContent = 'ÁôªÂΩï';
                    btn.disabled = false;
                }
            });
        }

        // Language Switcher Logic
        const langSwitch = document.querySelector('.lang-switch');
        const langBtn = document.getElementById('lang-btn');
        let currentLang = 'zh';
        
        const translations = {
            zh: {
                welcome: 'Ê¨¢ËøéÂõûÊù•ÔºÅ',
                usernameLabel: 'Áî®Êà∑Âêç / ÈÇÆÁÆ±',
                usernamePlaceholder: 'ËØ∑ËæìÂÖ•Áî®Êà∑Âêç',
                passwordLabel: 'ÂØÜÁ†Å',
                remember: '30Â§©ÂÜÖÂÖçÁôªÂΩï',
                forgot: 'ÂøòËÆ∞ÂØÜÁ†ÅÔºü',
                login: 'ÁôªÂΩï',
                signupText: 'ËøòÊ≤°ÊúâË¥¶Âè∑Ôºü',
                signupLink: 'Ê≥®ÂÜå',
                loggingIn: 'ÁôªÂΩï‰∏≠...',
                loginFailed: 'ÁôªÂΩïÂ§±Ë¥•',
                error: 'ÂèëÁîüÈîôËØØ'
            },
            en: {
                welcome: 'Welcome Back!',
                usernameLabel: 'Username / Email',
                usernamePlaceholder: 'Enter your username',
                passwordLabel: 'Password',
                remember: 'Remember for 30 days',
                forgot: 'Forgot password?',
                login: 'Log In',
                signupText: "Don't have an account?",
                signupLink: 'Sign Up',
                loggingIn: 'Logging in...',
                loginFailed: 'Login failed',
                error: 'An error occurred'
            }
        };

        if(langSwitch) {
            langSwitch.addEventListener('click', () => {
                currentLang = currentLang === 'zh' ? 'en' : 'zh';
                if(langBtn) langBtn.textContent = currentLang === 'zh' ? 'EN' : '‰∏≠Êñá';
                
                const t = translations[currentLang];
                const welcomeText = document.getElementById('welcome-text');
                if(welcomeText) welcomeText.textContent = t.welcome;
                
                const labelUsername = document.getElementById('label-username');
                if(labelUsername) labelUsername.textContent = t.usernameLabel;
                
                const usernameInput = document.getElementById('username');
                if(usernameInput) usernameInput.placeholder = t.usernamePlaceholder;
                
                const labelPassword = document.getElementById('label-password');
                if(labelPassword) labelPassword.textContent = t.passwordLabel;
                
                const labelRemember = document.getElementById('label-remember');
                if(labelRemember) labelRemember.textContent = t.remember;
                
                const linkForgot = document.getElementById('link-forgot');
                if(linkForgot) linkForgot.textContent = t.forgot;
                
                const btnLogin = document.getElementById('btn-login');
                if(btnLogin) btnLogin.textContent = t.login;
                
                const textSignup = document.getElementById('text-signup');
                if(textSignup) textSignup.textContent = t.signupText;
                
                const linkSignup = document.getElementById('link-signup');
                if(linkSignup) linkSignup.textContent = t.signupLink;
            });
        }

        // Forgot Password Logic
        const linkForgot = document.getElementById('link-forgot');
        if(linkForgot) {
            linkForgot.addEventListener('click', (e) => {
                e.preventDefault();
                alert('ËØ∑ÂØªÊâæÁÆ°ÁêÜÂëòËß£ÂÜ≥');
            });
        }

        // Registration Logic
        const linkSignup = document.getElementById('link-signup');
        if(linkSignup) {
            linkSignup.addEventListener('click', (e) => {
                e.preventDefault();
                showRegisterModal();
            });
        }

        function showRegisterModal() {
            const modalHtml = `
                <div id="register-modal" class="register-modal">
                    <div class="register-content">
                        <button class="register-close" type="button">&times;</button>
                        <div class="register-body">
                            <form id="registerForm">
                                <!-- Role Selection -->
                                <div class="form-group">
                                    <label class="form-label" style="display:block; margin-bottom:8px; font-weight:600; color:#2d3436;">ÈÄâÊã©Áî®Êà∑ËßíËâ≤</label>
                                    <div class="role-toggle">
                                        <button type="button" class="role-option" data-role="student">Â≠¶Áîü</button>
                                        <button type="button" class="role-option" data-role="teacher">ÊïôÂ∏à</button>
                                    </div>
                                    <input type="hidden" name="role" required>
                                </div>

                                <!-- Basic Info -->
                                <div class="input-group">
                                    <label style="display:block; margin-bottom:8px; font-weight:600; color:#2d3436;">ÁúüÂÆûÂßìÂêç *</label>
                                    <input type="text" name="fullName" required style="width:100%; padding:12px; border:2px solid #dfe6e9; border-radius:8px;" placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÁúüÂÆûÂßìÂêç">
                                </div>
                                <div class="input-group" style="margin-top:15px;">
                                    <label style="display:block; margin-bottom:8px; font-weight:600; color:#2d3436;">ÁôªÂΩïÁî®Êà∑Âêç *</label>
                                    <input type="text" name="username" required style="width:100%; padding:12px; border:2px solid #dfe6e9; border-radius:8px;" placeholder="ËØ∑ËæìÂÖ•ÁôªÂΩïÁî®Êà∑Âêç">
                                </div>
                                <div class="input-group" style="margin-top:15px;">
                                    <label style="display:block; margin-bottom:8px; font-weight:600; color:#2d3436;">ÁôªÂΩïÂØÜÁ†Å *</label>
                                    <input type="password" name="password" required style="width:100%; padding:12px; border:2px solid #dfe6e9; border-radius:8px;" placeholder="Ëá≥Â∞ë6‰ΩçÂØÜÁ†Å">
                                </div>
                                <div class="input-group" style="margin-top:15px;">
                                    <label style="display:block; margin-bottom:8px; font-weight:600; color:#2d3436;">Á°ÆËÆ§ÂØÜÁ†Å *</label>
                                    <input type="password" name="confirmPassword" required style="width:100%; padding:12px; border:2px solid #dfe6e9; border-radius:8px;" placeholder="ËØ∑ÂÜçÊ¨°ËæìÂÖ•ÂØÜÁ†Å">
                                </div>
                                <div class="input-group" style="margin-top:15px;">
                                    <label style="display:block; margin-bottom:8px; font-weight:600; color:#2d3436;">ÈÇÆÁÆ±Âú∞ÂùÄ</label>
                                    <input type="email" name="email" style="width:100%; padding:12px; border:2px solid #dfe6e9; border-radius:8px;" placeholder="ÂèØÈÄâÔºåÁî®‰∫éÊâæÂõûÂØÜÁ†Å">
                                </div>

                                <!-- Student Fields -->
                                <div id="student-fields" class="role-fields" style="display: none;">
                                    <div class="role-fields-title">Â≠¶Áîü‰ø°ÊÅØ</div>
                                    <div class="input-group">
                                        <label style="display:block; margin-bottom:8px; font-weight:600; color:#2d3436;">Â≠¶Âè∑</label>
                                        <input type="text" name="studentId" style="width:100%; padding:12px; border:2px solid #dfe6e9; border-radius:8px;" placeholder="ËØ∑ËæìÂÖ•Â≠¶Âè∑">
                                    </div>
                                    <div class="input-group" style="margin-top:15px;">
                                        <label style="display:block; margin-bottom:8px; font-weight:600; color:#2d3436;">‰∏ì‰∏ö</label>
                                        <input type="text" name="major" style="width:100%; padding:12px; border:2px solid #dfe6e9; border-radius:8px;" placeholder="ËØ∑ËæìÂÖ•‰∏ì‰∏ö">
                                    </div>
                                    <div class="input-group" style="margin-top:15px;">
                                        <label style="display:block; margin-bottom:8px; font-weight:600; color:#2d3436;">Âπ¥Á∫ß</label>
                                        <input type="text" name="grade" style="width:100%; padding:12px; border:2px solid #dfe6e9; border-radius:8px;" placeholder="ËØ∑ËæìÂÖ•Âπ¥Á∫ß">
                                    </div>
                                </div>

                                <!-- Teacher Fields -->
                                <div id="teacher-fields" class="role-fields" style="display: none;">
                                    <div class="role-fields-title">ÊïôÂ∏à‰ø°ÊÅØ</div>
                                    <div class="input-group">
                                        <label style="display:block; margin-bottom:8px; font-weight:600; color:#2d3436;">Â∑•Âè∑</label>
                                        <input type="text" name="employeeId" style="width:100%; padding:12px; border:2px solid #dfe6e9; border-radius:8px;" placeholder="ËØ∑ËæìÂÖ•Â∑•Âè∑">
                                    </div>
                                    <div class="input-group" style="margin-top:15px;">
                                        <label style="display:block; margin-bottom:8px; font-weight:600; color:#2d3436;">Èô¢Á≥ª</label>
                                        <input type="text" name="department" style="width:100%; padding:12px; border:2px solid #dfe6e9; border-radius:8px;" placeholder="ËØ∑ËæìÂÖ•Èô¢Á≥ª">
                                    </div>
                                    <div class="input-group" style="margin-top:15px;">
                                        <label style="display:block; margin-bottom:8px; font-weight:600; color:#2d3436;">ÁîµËØù</label>
                                        <input type="tel" name="phone" style="width:100%; padding:12px; border:2px solid #dfe6e9; border-radius:8px;" placeholder="ËØ∑ËæìÂÖ•ÁîµËØùÂè∑Á†Å">
                                    </div>
                                </div>

                                <div class="register-actions">
                                    <button type="button" class="btn-cancel">ÂèñÊ∂à</button>
                                    <button type="submit" class="btn-submit">Á´ãÂç≥Ê≥®ÂÜå</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHtml);

            // Show Modal
            setTimeout(() => {
                document.getElementById('register-modal').classList.add('show');
            }, 10);

            // Event Listeners
            const closeBtn = document.querySelector('.register-close');
            if (closeBtn) closeBtn.addEventListener('click', closeRegisterModal);

            const cancelBtn = document.querySelector('.btn-cancel');
            if (cancelBtn) cancelBtn.addEventListener('click', closeRegisterModal);

            // Role Toggle
            const roleOptions = document.querySelectorAll('.role-option');
            const roleInput = document.querySelector('input[name="role"]');
            const studentFields = document.getElementById('student-fields');
            const teacherFields = document.getElementById('teacher-fields');

            roleOptions.forEach(option => {
                option.addEventListener('click', () => {
                    roleOptions.forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                    roleInput.value = option.dataset.role;

                    const role = option.dataset.role;
                    if (role === 'student') {
                        studentFields.style.display = 'block';
                        teacherFields.style.display = 'none';
                    } else if (role === 'teacher') {
                        studentFields.style.display = 'none';
                        teacherFields.style.display = 'block';
                    }
                });
            });

            // Form Submit
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
        }

        function closeRegisterModal() {
            const modal = document.getElementById('register-modal');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.remove();
                }, 300);
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const password = formData.get('password');
            const confirmPassword = formData.get('confirmPassword');
            const role = formData.get('role');

            if (!role) {
                alert('ËØ∑ÂÖàÈÄâÊã©Áî®Êà∑ËßíËâ≤ÔºàÂ≠¶ÁîüÊàñÊïôÂ∏àÔºâÔºÅ');
                return;
            }

            if (password !== confirmPassword) {
                alert('‰∏§Ê¨°ËæìÂÖ•ÁöÑÂØÜÁ†Å‰∏ç‰∏ÄËá¥ÔºÅ');
                return;
            }

            if (password.length < 6) {
                alert('ÂØÜÁ†ÅÈïøÂ∫¶Ëá≥Â∞ë6‰ΩçÔºÅ');
                return;
            }

            const userData = {
                fullName: formData.get('fullName'),
                username: formData.get('username'),
                password: password,
                email: formData.get('email') || '',
                role: role,
                studentId: formData.get('studentId') || '',
                major: formData.get('major') || '',
                grade: formData.get('grade') || '',
                employeeId: formData.get('employeeId') || '',
                department: formData.get('department') || '',
                phone: formData.get('phone') || ''
            };

            const submitBtn = document.querySelector('.btn-submit');
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Ê≥®ÂÜå‰∏≠...';
            }

            try {
                const response = await fetch(`${API_BASE}/users/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(userData)
                });
                
                const result = await response.json();

                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Á´ãÂç≥Ê≥®ÂÜå';
                }

                if (result.success) {
                    closeRegisterModal();
                    alert('Ê≥®ÂÜåÊàêÂäüÔºÅ\n\nÁî®Êà∑ÂêçÔºö' + userData.username + '\nÂØÜÁ†ÅÔºö' + userData.password + '\n\nÁé∞Âú®ÂèØ‰ª•ÁôªÂΩï‰∫Ü');
                } else {
                    alert('Ê≥®ÂÜåÂ§±Ë¥•Ôºö' + (result.message || 'Êú™Áü•ÈîôËØØ'));
                }
                
            } catch (error) {
                console.error('Register Error:', error);
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Á´ãÂç≥Ê≥®ÂÜå';
                }
                alert('Ê≥®ÂÜåÂ§±Ë¥•Ôºö' + error.message);
            }
        }
    </script>
</body>
</html>
